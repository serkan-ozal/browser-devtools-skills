# Observability (o11y) Tools

Performance monitoring, logging, and tracing commands.

## get-web-vitals

Collect Web Vitals performance metrics with recommendations.

```bash
browser-devtools-cli o11y get-web-vitals [options]
```

**Arguments:**

| Argument | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `--wait-ms` | number | No | `0` | Wait duration before reading metrics (0-30000) |
| `--include-debug` | boolean | No | `false` | Include debug details |

**Metrics collected:**

| Metric | Description | Good | Poor |
|--------|-------------|------|------|
| LCP (ms) | Largest Contentful Paint | ≤ 2500 | > 4000 |
| INP (ms) | Interaction to Next Paint | ≤ 200 | > 500 |
| CLS (score) | Cumulative Layout Shift | ≤ 0.1 | > 0.25 |
| TTFB (ms) | Time to First Byte | ≤ 800 | > 1800 |
| FCP (ms) | First Contentful Paint | ≤ 1800 | > 3000 |

**Examples:**

```bash
# Basic metrics
browser-devtools-cli o11y get-web-vitals

# Wait for metrics to settle
browser-devtools-cli o11y get-web-vitals --wait-ms 2000

# With debug info (JSON for parsing)
browser-devtools-cli --json o11y get-web-vitals --include-debug
```

**Output (JSON):**

```json
{
  "url": "https://example.com/",
  "metrics": {
    "lcpMs": 1200,
    "inpMs": 150,
    "cls": 0.05,
    "ttfbMs": 400,
    "fcpMs": 900
  },
  "ratings": {
    "lcp": { "rating": "good", "value": 1200 },
    "inp": { "rating": "good", "value": 150 },
    "cls": { "rating": "good", "value": 0.05 }
  },
  "recommendations": {
    "coreWebVitalsPassed": true,
    "summary": ["Core Web Vitals look good..."]
  }
}
```

---

## get-console-messages

Capture browser console messages.

```bash
browser-devtools-cli o11y get-console-messages [options]
```

**Arguments:**

| Argument | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `--type` | enum | No | - | Filter by level (this level or higher): `all`, `debug`, `info`, `warning`, `error` |
| `--search` | string | No | - | Filter by message text (substring) |
| `--timestamp` | number | No | - | Only messages at or after this Unix ms |
| `--sequence-number` | number | No | - | Only messages with sequence > this (incremental polling) |
| `--limit` | object | No | - | JSON: `{"count":100,"from":"end"}` — max messages to return; `from`: `start` or `end` |

**Examples:**

```bash
# All console messages
browser-devtools-cli o11y get-console-messages

# Errors only (and higher severity; here error is highest)
browser-devtools-cli --json o11y get-console-messages --type error

# Warnings and errors (filter by level: warning or higher)
browser-devtools-cli --json o11y get-console-messages --type warning

# Search in message text
browser-devtools-cli --json o11y get-console-messages --search "failed"
```

---

## get-http-requests

Monitor HTTP requests and responses. Filtering is done server-side by resource type, status range, and optional incremental (sequenceNumber) / limit.

```bash
browser-devtools-cli o11y get-http-requests [options]
```

**Arguments:**

| Argument | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `--resource-type` | enum | No | - | Filter by type: `document`, `stylesheet`, `image`, `media`, `font`, `script`, `texttrack`, `xhr`, `fetch`, `eventsource`, `websocket`, `manifest`, `other` |
| `--status-min` | number | No | - | Only requests with response status ≥ this |
| `--status-max` | number | No | - | Only requests with response status ≤ this |
| `--ok` | boolean | No | - | If true, only 2xx responses |
| `--timestamp` | number | No | - | Only requests at or after this Unix ms |
| `--sequence-number` | number | No | - | Only requests with sequence > this (incremental polling) |
| `--limit` | object | No | - | JSON: `{"count":100,"from":"end"}` — max requests to return; `from`: `start` or `end` |

**Examples:**

```bash
# All requests (JSON for parsing)
browser-devtools-cli --json o11y get-http-requests

# Only fetch/XHR (API calls)
browser-devtools-cli --json o11y get-http-requests --resource-type fetch
browser-devtools-cli --json o11y get-http-requests --resource-type xhr

# Failed requests (status >= 400)
browser-devtools-cli --json o11y get-http-requests --status-min 400

# Only 5xx errors
browser-devtools-cli --json o11y get-http-requests --status-min 500 --status-max 599

# Successful only (2xx)
browser-devtools-cli --json o11y get-http-requests --ok true
```

---

## get-trace-id

Get the current OpenTelemetry trace ID.

```bash
browser-devtools-cli o11y get-trace-id
```

---

## new-trace-id

Generate a new OpenTelemetry trace ID.

```bash
browser-devtools-cli o11y new-trace-id
```

---

## set-trace-id

Set a specific OpenTelemetry trace ID.

```bash
browser-devtools-cli o11y set-trace-id --trace-id <id>
```

**Arguments:**

| Argument | Type | Required | Default | Description |
|----------|------|----------|---------|-------------|
| `--trace-id` | string | Yes | - | Trace ID to set |

**Example:**

```bash
browser-devtools-cli o11y set-trace-id --trace-id "custom-trace-123"
```

## Performance Analysis Example

```bash
SESSION="--session-id perf-test --json"

# Navigate
browser-devtools-cli $SESSION navigation go-to --url "https://example.com"

# Wait for load
browser-devtools-cli $SESSION sync wait-for-network-idle

# Get Web Vitals (wait for metrics to settle)
VITALS=$(browser-devtools-cli $SESSION o11y get-web-vitals --wait-ms 2000)
echo "Web Vitals: $VITALS"

# Check for console errors
ERRORS=$(browser-devtools-cli $SESSION o11y get-console-messages --type error)
echo "Errors: $ERRORS"

# Analyze HTTP requests
REQUESTS=$(browser-devtools-cli $SESSION o11y get-http-requests)
echo "Requests: $REQUESTS"

# Screenshot for reference
browser-devtools-cli $SESSION content take-screenshot --name "perf-analysis"
```

## Distributed Tracing Example

```bash
SESSION="--session-id trace-test --json"

# Set trace ID for correlation
browser-devtools-cli $SESSION o11y set-trace-id --trace-id "test-trace-001"

# Navigate and perform actions
browser-devtools-cli $SESSION navigation go-to --url "https://api.example.com"
browser-devtools-cli $SESSION interaction click --selector "#fetch-data"
browser-devtools-cli $SESSION sync wait-for-network-idle

# Get HTTP requests with trace
browser-devtools-cli $SESSION o11y get-http-requests

# Verify trace ID
browser-devtools-cli $SESSION o11y get-trace-id
```

## CI/CD Health Check Example

```bash
#!/bin/bash
set -e

CLI="browser-devtools-cli --json --quiet --session-id health-$$"

# Navigate
$CLI navigation go-to --url "https://example.com"
$CLI sync wait-for-network-idle

# Check Web Vitals
VITALS=$($CLI o11y get-web-vitals --wait-ms 1000)
LCP=$(echo $VITALS | jq '.metrics.lcpMs')
if [ "$LCP" -gt 4000 ]; then
  echo "LCP too high: $LCP ms"
  exit 1
fi

# Check for console errors
ERRORS=$($CLI o11y get-console-messages --type error)
if [ "$ERRORS" != "[]" ]; then
  echo "Console errors: $ERRORS"
  exit 1
fi

echo "Health check passed"
```
